# Development Rules / –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

### 1. Queue-First Architecture - –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å

**–í–°–ï –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Pelephone API –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å!**

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ –≤–Ω–µ—à–Ω–∏–π API
- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π** (audit trail)
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ **Retry –ª–æ–≥–∏–∫–∞** –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** –æ–ø–µ—Ä–∞—Ü–∏–π

**–ù–ï –î–û–ü–£–°–ö–ê–ï–¢–°–Ø:**
- ‚ùå –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã Pelephone API –∏–∑ handlers
- ‚ùå –û–±—Ö–æ–¥ –æ—á–µ—Ä–µ–¥–∏ "–¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏"
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞ –≤ HTTP handler

**–ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–ê–¢–¢–ï–†–ù:**
```go
// Handler —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥–∏
task, err := services.Queue.CreateTask(services.CreateTaskRequest{
    Type:       models.TaskTypeLabelUpdate,
    MSISDN:     req.Msisdn,
    LabelField: normalizedField,
    LabelValue: req.Value,
    // ...
})

// Worker –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π API –≤—ã–∑–æ–≤
// —Å–º. internal/jobs/worker.go
```

---

### 2. API –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è - –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–ù–ï –í–´–î–£–ú–´–í–ê–¢–¨ —Ñ–æ—Ä–º–∞—Ç—ã API –≤—ã–∑–æ–≤–æ–≤!**

–ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏–ª–∏ –æ—Ç–ª–∞–¥–∫–µ –ª—é–±—ã—Ö API –≤—ã–∑–æ–≤–æ–≤:

1. **–°–ù–ê–ß–ê–õ–ê** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:
   - `docs/_spec_extract/pelephone_api_v1.5.2_fulltext.txt` - –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - `docs/upstream_api_spec/swagger.json` - Swagger —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
   - PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Pelephone API

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**:
   - –ù–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π (actionType, targetId, targetValue –∏ —Ç.–¥.)
   - –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
   - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ/–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
   - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

3. **–ù–ï –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞**:
   - –ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –æ —Ñ–æ—Ä–º–∞—Ç–µ
   - "–õ–æ–≥–∏—á–Ω—ã–µ" –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π
   - –ö–æ–¥ –∏–∑ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–∏–º–µ—Ä —É—Ä–æ–∫–∞ (2026-02-05):

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û** (–∫–∞–∫ –±—ã–ª–æ):
```json
{
  "actionType": "CUSTOMER_LABEL_UPDATE",
  "targetId": "1",
  "targetValue": "new value"
}
```

**–ü–†–ê–í–ò–õ–¨–ù–û** (–ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ PDF v1.5.2):
```json
{
  "actionType": "CUSTOMER_LABEL_1",
  "targetId": "",
  "targetValue": "new value"
}
```

–û—à–∏–±–∫–∞ —Å—Ç–æ–∏–ª–∞ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç–ª–∞–¥–∫—É. API –≤–æ–∑–≤—Ä–∞—â–∞–ª "Permission Denied" –ø–æ—Ç–æ–º—É —á—Ç–æ actionType –±—ã–ª –Ω–µ–≤–µ—Ä–Ω—ã–π.

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] API –≤—ã–∑–æ–≤—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ credentials
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üìÅ –ì–¥–µ –∏—Å–∫–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

| –î–æ–∫—É–º–µ–Ω—Ç | –ü—É—Ç—å |
|----------|------|
| Pelephone API spec (—Ç–µ–∫—Å—Ç) | `docs/_spec_extract/pelephone_api_v1.5.2_fulltext.txt` |
| Pelephone API paths | `docs/_spec_extract/pelephone_api_v1.5.2_paths.txt` |
| Swagger JSON | `docs/upstream_api_spec/swagger.json` |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ | `docs/ARCHITECTURE.md` |

## üîß Pelephone API - –ö—Ä–∞—Ç–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–π–±–ª–æ–≤ SIM

Endpoint: `POST /ipa/apis/json/provisioning/updateProvisioningData`

```json
{
  "actions": [{
    "actionType": "CUSTOMER_LABEL_1",  // –∏–ª–∏ CUSTOMER_LABEL_2, CUSTOMER_LABEL_3
    "targetValue": "–∑–Ω–∞—á–µ–Ω–∏–µ",
    "targetId": "",
    "subscribers": [{"neId": "0502xxxxxx"}]
  }]
}
```

**actionType –¥–ª—è –ª–µ–π–±–ª–æ–≤:**
- `CUSTOMER_LABEL_1` - Label 1
- `CUSTOMER_LABEL_2` - Label 2  
- `CUSTOMER_LABEL_3` - Label 3

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö SIM

Endpoint: `POST /ipa/apis/json/provisioning/getProvisioningData`

```json
{
  "neIds": ["0502xxxxxx", "0502yyyyyy"],
  "attributes": ["CUSTOMER_LABEL_1", "CUSTOMER_LABEL_2", "CUSTOMER_LABEL_3", "..."]
}
```
